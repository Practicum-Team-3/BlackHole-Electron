<!DOCTYPE html>

<html>
    <head>
		<link rel="stylesheet" href="../CoreComponents/CSS/Bootstrap/bootstrap.css">
		<script src="../../../Electron/node_modules/jquery/dist/jquery.js"></script>
		<link rel="stylesheet" href="../CoreComponents/CSS/Bootstrap/site.css">	
		<script scr="../CoreComponents/CSS/Bootstrap/bootstrap.js"></script>
		<link href="../CoreComponents/CSS/Bootstrap/all.css" rel="stylesheet">
        <!--link rel="stylesheet" href="../CoreComponents/CSS/Bootstrap/bootstrap.css"-->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
        
        <!-- <script src="../../../Electron/widow/scenarios.js"></script> -->
        <meta charset="UTF-8">

        <script>
            var {remote} = require('electron');
			var scenarios = remote.getGlobal('scenarios');
        </script>

        <title>BlackHole</title>
		
    </head>
    <body>		
		<div class="container" style="height:540px;">

			<div class="row">				
				<div class="col-md-12 text-right" style="height:45px; padding-top:5px;">
					<button type="submit" onClick="window.location='../welcomeWindow/welcomeWindow.html';" class="btn btn-primary fa fa-backward"></button>
                </div>
                <div class="col-md-12 text-left" style="height:45px; border-bottom:2px solid gray;">
                    <h3>MachineList</h3>
				</div>
            </div>

			<div class="row" id="content_ns" style="padding-top:8px">
				<div class="col-md-6" style="border-right:double gray;">
                    <label>Exploit VMs</label>
					<table id="exploitTbl" class="table">
					  <thead>
						<tr>
                            <th scope="col"></th>
                            <th scope="col">Name</th>
                            <th scope="col">OS</th>
                            <th scope="col">Exploit</th>
                            <th scope="col"></th>
                            <th scope="col"></th>
                          </tr>
					    </thead>
					  <tbody>

					  </tbody>
					</table>
				</div>
				
				<div class="col-md-6">
                    <label>Vulnerability VMs</label>
					<table id="vulnTbl" class="table">
					  <thead>
						<tr>
                            <th scope="col"></th>
                            <th scope="col">Name</th>
                            <th scope="col">OS</th>
                            <th scope="col">Vulnerability</th>
                            <th scope="col"></th>
                            <th scope="col"></th>
						</tr>
					  </thead>
					  <tbody>

					  </tbody>
					</table>						
				</div>						
            </div>
            <div class="row" id="add_buttons" style="height:45px; padding-top:10px; padding-bottom:10px;">
                <div class="col-11">
                    <div class="text-center">
                        <button type="submit" onClick="window.location='../MachineEditWindow/machineEdit.html'" class="btn btn-primary" style="width: 40%;" data-toggle="modal" data-target="#myModal">Add VM</button>					
                    </div>
                </div>
                <div class="col-1" id="save_button_row">
                    <div class="text-right">						
                        <button type="submit" style="margin-right:120px;" onClick="saveScenario()" class="btn btn-primary">Save</button>		
                    </div>
                </div>
            </div>
            
			<footer class="footer fixed-bottom container">
					<hr>
					<p>&copy; 2020 Company, Inc.</p>
			</footer>
		</div>
    

        <script>
            var scenario;
            var attackerMachinesList;
            var victimMachinesList;

            //get scenario name from url
            // var query = location.search.substring(1);
            // var parameters = {};
            // var keyValues = query.split(/&/);
            // for (var keyValue in keyValues) {
            //     var keyValuePairs = keyValue.split(/=/);
            //     var key = keyValuePairs[0];
            //     var value = keyValuePairs[1];
            //     parameters[key] = value;
            // }

            //remove after testing
            // parameters = {"scenarioName":"Scenario 1"}

            // var sName = parameters['scenarioName'];
            
            
            scenario = scenarios.getScenarioBeingCreated();
            attackerMachinesList = scenario.getAllAttackerMachines();
            victimMachinesList = scenario.getAllVictimMachines();
            populateVMLists(attackerMachinesList, victimMachinesList);
            

            function populateVMLists(attackerMachinesList, victimMachinesList){
                //populate attackers
                for(var i = 0; i<attackerMachinesList.length; i++){
                    itemsAddExploitVM(attackerMachinesList[i]);
                }

                //populate victims
                for(var i = 0; i<victimMachinesList.length; i++){
                    itemsAddVulnVM(victimMachinesList[i]);
                }
            }
            
            function itemsAddExploitVM(machine) {
                var mName = machine.getName();
            $("#exploitTbl tbody").append(
                "<tr>" +
                    "<td class='fa fa-bug'></td>" +
                    "<td>" + mName + "</td>" +
                    "<td>" + machine.getOs() + "</td>" +
                    "<td></td>" +
                    "<td onclick='editVM()'><i class='fa fa-pen'></i></td>" +
                    "<td onclick='delRow(this)'><i class='fa fa-minus-circle'></i></td>" +
                "</tr>"
            );
            }
            
            function itemsAddVulnVM(machine) {
            $("#vulnTbl tbody").append(
                "<tr>" +
                    "<td class='fa fa-desktop'></td>" +
                    "<td>" + mName + "</td>" +
                    "<td>" + machine.getOs() + "</td>" +
                    "<td></td>" +
                    "<td onclick='editVM()'><i class='fa fa-pen'></i></td>" +
                    "<td onclick='delRow(this)'><i class='fa fa-minus-circle'></i></td>" +
                "</tr>"
            );
            }
            
            function delRow(e){
                $(e).closest('tr').remove();
            }

            function editVM(){
                //Call MachineSettings Window
			    window.open("../MachineEditWindow/machineEdit.html");
            }

            function saveScenario(){
                scenarios.completeScenarioCreation();
                window.location='../welcomeWindow/welcomeWindow.html'
            }

        </script>
    </body>
</html>